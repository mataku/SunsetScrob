name: Change Google Play Track Status

on:
  workflow_dispatch:
    inputs:
      operation:
        description: 'Google Play Track Release'
        required: true
        type: choice
        options:
          - resume
          - halt
          - update_rollout

jobs:
  status-change:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    permissions:
      id-token: write
      contents: read
    steps:
      - id: auth
        uses: google-github-actions/auth@7c6bc770dae815cd3e89ee6cdf493a5fab2cc093 # v3.0.0
        with:
          create_credentials_file: true
          workload_identity_provider: ${{ secrets.WORKFLOW_IDENTITY_PROVIDER }}
          service_account: ${{ secrets.GOOGLE_SERVICE_ACCOUNT }}
      - name: Checkout halt action repository
        uses: actions/checkout@v6
        with:
          repository: mataku/halt-google-play-release-action
          token: ${{ secrets.ACTIONS_CHECKOUT_TOKEN }}
          path: .github/actions/halt-google-play-release-action
      - name: Checkout resume action repository
        uses: actions/checkout@v6
        with:
          repository: mataku/resume-google-play-release-action
          token: ${{ secrets.ACTIONS_CHECKOUT_TOKEN }}
          path: .github/actions/resume-google-play-release-action
      - name: Checkout halt action repository
        uses: actions/checkout@v6
        with:
          repository: mataku/update-google-play-release-rollout-action
          token: ${{ secrets.ACTIONS_CHECKOUT_TOKEN }}
          path: .github/actions/update-google-play-release-rollout-action
      - name: Resume Google Play Track
        if: ${{ inputs.operation == 'resume' }}
        uses: ./.github/actions/resume-google-play-release-action
        with:
          package-name: 'com.mataku.scrobscrob'
          version-name: '1.21.1'
          google-account-json-file-path: ${{ steps.auth.outputs.credentials_file_path }}
          track: 'internal'
      - name: Halt Google Play Track
        if: ${{ inputs.operation == 'halt' }}
        uses: ./.github/actions/halt-google-play-release-action
        with:
          package-name: 'com.mataku.scrobscrob'
          version-name: '1.21.1'
          google-account-json-file-path: ${{ steps.auth.outputs.credentials_file_path }}
          track: 'internal'
      - name: Update Google Play Track Rollout
        if: ${{ inputs.operation == 'update_rollout' }}
        uses: ./.github/actions/update-google-play-release-rollout-action
        with:
          package-name: 'com.mataku.scrobscrob'
          version-name: '1.21.1'
          google-account-json-file-path: ${{ steps.auth.outputs.credentials_file_path }}
          track: 'internal'
          user-fraction: '0.55'
